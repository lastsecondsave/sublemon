# [PackageDev] target_format: plist, ext: tmLanguage
name: Java Server Page (JSP)
scopeName: text.html.jsp
fileTypes: [jsp]
uuid: ACB58B55-9437-4AE6-AF42-854995CF51DF

patterns:
- name: comment.block.jsp
  begin: <%--
  end: --%>
  captures:
    '0': {name: punctuation.definition.comment.jsp}

- name: meta.directive.jsp
  begin: <%@
  end: '%>'
  captures:
    '0': {name: punctuation.section.directive.jsp}
  patterns:
  - begin: \w+
    beginCaptures:
      '0': {name: keyword.other.directive.jsp}
    end: (?=%>)
    patterns:
    - name: constant.other.directive.attribute.jsp
      match: \w+
    - name: keyword.operator.assignment.jsp
      match: '='
    - name: string.quoted.double.jsp
      begin: '"'
      beginCaptures:
        '0': {name: punctuation.definition.string.begin.jsp}
      end: '"'
      endCaptures:
        '0': {name: punctuation.definition.string.end.jsp}
      patterns:
      - name: constant.character.escape.jsp
        match: \\.
    - name: string.quoted.single.jsp
      begin: "'"
      beginCaptures:
        '0': {name: punctuation.definition.string.begin.jsp}
      end: "'"
      endCaptures:
        '0': {name: punctuation.definition.string.end.jsp}
      patterns:
      - match: \\.
        name: constant.character.escape.jsp

- begin: (<%[!=]?)|(<jsp:scriptlet>|<jsp:expression>|<jsp:declaration>)
  beginCaptures:
    '1': {name: punctuation.section.embedded.jsp}
    '2': {name: meta.tag.block.jsp}
  end: (?<=</jsp:scriptlet>|</jsp:expression>|</jsp:declaration>|%>)
  patterns:
  - match: (</jsp:scriptlet>|</jsp:expression>|</jsp:declaration>)|(%>)
    captures:
      '1': {name: meta.tag.block.jsp}
      '2': {name: punctuation.section.embedded.jsp}
  - name: source.java.embedded.html
    begin: (?<!\n)(?!</jsp:scriptlet>|</jsp:expression>|</jsp:declaration>|%>|\{|\})
    end: (?=</jsp:scriptlet>|</jsp:expression>|</jsp:declaration>|%>|\{|\})|\n
    patterns:
    - include: source.java
  - begin: '{'
    end: '}'
    patterns:
    - begin: (</jsp:scriptlet>|</jsp:expression>|</jsp:declaration>)|(%>)
      end: (<jsp:scriptlet>|<jsp:expression>|<jsp:declaration>)|(<%[!=]?)
      captures:
        '1': {name: meta.tag.block.jsp}
        '2': {name: punctuation.section.embedded.jsp}
      patterns:
      - include: text.html.jsp
    - include: source.java
  - include: source.java

- include: text.html.basic

foldingStartMarker: /\*\*|\{\s*$
foldingStopMarker: \*\*/|^\s*\}
keyEquivalent: ^~J
